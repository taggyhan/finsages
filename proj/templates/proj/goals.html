

{% extends "proj/layout.html" %}

{% block content %}
<div class="container">
    <h2>Goals</h2>
    <table class="table table-striped">
        <thead>
            <tr>
                <th>Name</th>
                <th>Target Amount</th>
                <th>Months to Save</th>
                <th>Amount Saved</th>
                <th>Start Date</th> <!-- New column header -->
                <th>Progress</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for goal in goals %}
            <tr>
                <td>{{ goal.name }}</td>
                <td>{{ goal.target_amount }}</td>
                <td>{{ goal.months_to_save }}</td>
                <td>{{ goal.amount_saved }}</td>
                <td>{{ goal.goal_date }}</td> <!-- New column data -->
                <td>
                    <div class="progress-circle" data-progress="{{ goal.amount_saved|floatformat:2 }}" data-target="{{ goal.target_amount|floatformat:2 }}"></div>
                </td>
                <td>
                    <div class="action-buttons">
                        <a href="{% url 'update_goal' goal.id %}" class="btn btn-primary btn-sm">Edit</a>
                        <form method="post" action="{% url 'delete_goal' goal.id %}" style="display:inline;">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-danger btn-sm">Delete</button>
                        </form>
                    </div>
                </td>
            </tr>
            {% endfor %}
            <tr>
                <th><a href="{% url 'add_goal' %}" class="btn btn-success btn-link">Add New Goal</a></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th><a href="{% url 'chatbot' %}" class="btn btn-success btn-link">Get advice</a></th>
            </tr>
        </tbody>
    </table>
</div>

<style>
   .container {
    max-width: 90%; /* Increase the width of the container */
    margin: 20px auto;
    padding: 20px;
    background-color: #f8f9fa;
    border: 1px solid #e9ecef;
    border-radius: 0.25rem;
    box-shadow: 0 0.125rem 0.25rem rgba(0,0,0,0.075);
}

.table {
    width: 100%; /* Ensure the table uses the full width of the container */
    margin-bottom: 1rem;
    color: #212529;
    border-collapse: collapse;
}

.table th,
.table td {
    padding: 0.75rem;
    vertical-align: middle;
    text-align: center;
    border-top: 1px solid #dee2e6;
}

    .table thead th {
        vertical-align: bottom;
        border-bottom: 2px solid #dee2e6;
    }
    .table tbody + tbody {
        border-top: 2px solid #dee2e6;
    }
    .btn {
        padding: 10px 15px;
        font-size: 18px;
        border-radius: 5px;
        border: none;
        cursor: pointer;
        transition: background-color 0.2s;
    }
    .btn-primary {
        color: #fff;
        background-color: #007bff;
    }
    .btn-primary:hover {
        background-color: #0056b3;
    }
    .btn-danger {
        color: #fff;
        background-color: #dc3545;
    }
    .btn-danger:hover {
        background-color: #c82333;
    }
    .btn-success {
        color: #fff;
        background-color: #28a745;
    }
    .btn-success:hover {
        background-color: #218838;
    }
    .btn-link {
        margin-top: 10px;
        display: inline-block;
    }
    .progress-circle {
    width: 50px;
    height: 50px;
    display: flex;
    align-items: center; /* Vertically center the circle */
    justify-content: center; /* Horizontally center the circle */
    margin: 0 auto; /* Ensure the progress circle itself is centered within its parent */
}
    .progress-circle:before {
        content: '';
        display: block;
        padding-top: 100%;
    }
    .table td {
    vertical-align: middle; /* Center content vertically in table cells */
    text-align: center; /* Center content horizontally in table cells */
}

.progress-circle svg {
    width: 100%;
    height: 100%;
}
    .progress-circle circle {
        fill: none;
        stroke-width: 10;
    }
    .progress-circle .background {
        stroke: #e6e6e6;
    }
    .progress-circle .progress {
        stroke: #23cf7f;
        stroke-linecap: round;
        transition: stroke-dashoffset 0.3s;
    }
    .action-buttons {
        display: flex;
        gap: 10px;
        justify-content: center; /* Center-align the action buttons */
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        var circles = document.querySelectorAll('.progress-circle');
        circles.forEach(function(circle) {
            var progress = parseFloat(circle.getAttribute('data-progress'));
            var target = parseFloat(circle.getAttribute('data-target'));
            var percentage = (progress / target) * 100;
            var radius = 20;
            var circumference = 2 * Math.PI * radius;
            var offset = circumference - (percentage / 100) * circumference;

            var svg = `<svg>
                        <circle class="background" cx="25" cy="25" r="20"></circle>
                        <circle class="progress" cx="25" cy="25" r="20" style="stroke-dasharray: ${circumference}; stroke-dashoffset: ${offset};"></circle>
                        <text x="25" y="30" text-anchor="middle" fill="#000" font-size="10">${Math.round(percentage)}%</text>
                       </svg>`;
            circle.innerHTML = svg;
        });
    });
</script>
{% endblock %}
